import numpy as np
import robot_dynamics_module  # 导入编译好的模块

# 创建机器人动力学对象
robot = robot_dynamics_module.RobotDynamics()

# 准备输入数据（8个关节）
q = np.array([0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8]).reshape(-1, 1)
dq = np.array([0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8]).reshape(-1, 1)
ddq = np.array([0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8]).reshape(-1, 1)

P = np.array([0.361947730586870,
1.18146032478117,
-0.311438790244927,
0.144924453284350,
-0.530406397278906,
-1.20325897369918,
-1.31222146281048,
-0.378908279351564,
-0.729964116897246,
-0.0326977911962197,
-0.529494239807536,
0.257268380023134,
0.480751832904905,
0.171891728536315,
0.0749472843797934,
-0.219768983615916,
-1.16443851372612,
-0.0587328152694757,
0.242743264137860,
0.212722932937533,
0.0881117404052146,
0.0595671530152492,
-0.0592420231820216,
-0.201032099408551,
0.0684864385653971,
0.00432588384883142,
0.0920307759843578,
0.111913707161329,
-0.0672833832240317,
-0.0891463157383910,
0.346702390531191,
0.114019063241708,
0.0168817393863988,
-0.0283200999573928,
0.00548722944713687,
0.0198728617512821,
-0.0164574648592853,
-0.00225510952562923,
-0.0352033032987935,
-0.0547580477601286,
-0.0498393092111150,
-0.00728046363341095,
0.0151329019871055,
-0.0152217564158257,
-0.00161918669374925,
-0.0416011621574690,
-0.0483987756301256,
-0.0479404102265177,
0.0271026235972935,
-0.0569185200932264,
-0.0163358997205651,
-0.0263621832380958,
0.727822209701305,
1.71439132758388,
0.237588371818725,
1.55509705172115,
0.832219887253168,
0.334949179606259,
0.563095331234535,
0.262867526728865,
0.601474535017048,
1.06788951253705,
0.112546151155184,
0.0201517705659245,
0.155927846169681,
-0.00307227626961015,
0.0933433376173410,
0.213126330763255]).reshape(-1, 1)

# 计算基础回归矩阵
Yr = robot.pmin_calc(q, dq, ddq)

print(f"Yr shape: {Yr.shape}")
print(f"Yr:\n{Yr}")

# 计算摩擦项回归矩阵
Yc = robot.Yc_calc(dq)
print(f"Yc shape: {Yc.shape}")
print(f"Yc:\n{Yc}")

# 合并基础回归矩阵和摩擦项回归矩阵
Y = np.hstack((Yr, Yc))
print(f"Y shape: {Y.shape}")

print(f"P shape: {P.shape}")

# 计算关节力矩
tor = Y @ P           
print("tor shape:", tor.shape)
print(f"tor:\n{tor}")


# 保存矩阵到txt文件
np.savetxt('Yr.txt', Yr, fmt=f'%.8f', delimiter=', ')
