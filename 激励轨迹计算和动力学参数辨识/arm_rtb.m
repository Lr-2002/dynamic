            
clc,clear;
close all;
type = 'modified';
% type = 'standard';

d2r = pi/180;

a0 = 0.388575;
a2 = 0.04; a3 = 0.029998;
d1 = 0.07+0.12; d3 = 0.32; d5 = 0.32;
dtheta1 = 15.6772*d2r;
dtheta2 = -15.677*d2r;
 
         % d        theta         a        alpha
% DH = [-0.12 ,   15.6772 , 0.388575 ,   0;
%             -0.07     , -15.677   , 0       , -90;     
%             1e-06    ,   89.9996  , 0.04     ,  89.9998;
%             -0.32     ,  -90.0006  ,0.029998 ,-90.0002;
%             -0       ,  180      , 0.029998 , -90.0002; 
%             -0.32   ,   -0      ,0        , -90; 
%             0       ,   90       , 0       ,90];

%  theta      d       a        alpha 
DH = [pi, -d1, a0, 0;
    -pi/2, 0, 0, pi/2;
    pi/2, -d3, a2, pi/2;
    0, 0, -a3, pi/2;
    0, -d5, a3, -pi/2;
    pi/2, 0, 0, -pi/2;
    0, 0, 0, pi/2];


%       theta   d                  a        alpha     offset
ML0=Link([0     0         0        0         0     ],type); 
ML1=Link([0     DH(1, 2)         DH(1, 3)        DH(1, 4)         0     ],type); 
ML2=Link([0     DH(2, 2)         DH(2, 3)        DH(2, 4)         0     ],type);
ML3=Link([0     DH(3, 2)         DH(3, 3)        DH(3, 4)         0     ],type);
ML4=Link([0     DH(4, 2)         DH(4, 3)        DH(4, 4)         0     ],type);
ML5=Link([0     DH(5, 2)         DH(5, 3)        DH(5, 4)         0     ],type);
ML6=Link([0     DH(6, 2)         DH(6, 3)        DH(6, 4)          0     ],type);
ML7=Link([0     DH(7, 2)         DH(7, 3)        DH(7, 4)         0     ],type);

% 设置关节限位
ML0.qlim=[0,0];
ML1.qlim=[-2*pi,2*pi];
ML2.qlim=[-2*pi,2*pi];
ML3.qlim=[-2*pi,2*pi];
ML4.qlim=[-2*pi,2*pi];
ML5.qlim=[-2*pi,2*pi];
ML6.qlim=[-2*pi,2*pi];
ML7.qlim=[-2*pi,2*pi];

% 设置动力学参数
ML0.I = [0 0 0 0 0 0];
ML1.I=[0.0130054610249430    0.0126432982845938    0.00304057724988892    1.04773242543875e-07    3.36930562173167e-08    1.97978199771033e-07]; 
ML2.I=[0.00946278831752682    0.0553795287008555    0.0578506120703156    7.75275198966783e-06    -2.46668867351700e-05    0.0140430717163397];
ML3.I=[0.0232370048059518    0.0246958098057959    0.00411988378518828    -2.20926979634116e-07    0.00480156257385533    5.11912442224381e-09];
ML4.I=[0.0178586513380233    0.00564090893437307    0.0184305239276383    -4.23659979096986e-08    -8.59969608419540e-09    0.00476996887470281];
ML5.I=[0.0249875447290189    0.0246527209989213    0.00304477036502595    -0.000513594938972087    6.25515661295451e-08    5.01149446728772e-09];
ML6.I=[0.00181506422945424    0.00139034791580662    0.00168529251422364    -7.90659956266657e-09    -7.93157223051341e-07    5.13807816716780e-08];
ML7.I=[0.000241844560420860    0.00194941267344594    0.00178973999366715    -2.74559444589321e-06    0.000175117464464072    1.59987410761944e-05];

ML0.m = 0;
ML1.m=2.425401777345490;
ML2.m=3.497993978672940;
ML3.m=2.658462339233220;
ML4.m=2.521156491603480;
ML5.m=2.709373038482040;
ML6.m=1.565659722506630;
ML7.m=0.248870706997736;

ML0.r=[0 0 0]';
ML1.r=[2.10842857062410e-08    1.05328380284320e-06    -0.0600026251768112]';
ML2.r=[0.100780187984731    -0.0320314941552007    7.08750895786203e-05]';
ML3.r=[0.0164300740796524    -7.00106071227502e-07    -0.0812180663590132]';
ML4.r=[0.0242991038795073    -0.0617470002619906    -3.11961861898524e-09]';
ML5.r=[4.81473833718882e-07    -0.00175223533573748    -0.0848424632271686]';
ML6.r=[0.00228421690013919    1.11771492061763e-09    0.000221769788422033]';
ML7.r=[0.0781805844686497    -0.000461921559987893    -0.0108118148272705]';

L0.G=2;
L1.G=2;
L2.G=2;
L3.G=5;
L4.G=4;
L5.G=4;
L6.G=4;
L7.G=4;

L0.Jm=1;
L1.Jm=1;
L2.Jm=1;
L3.Jm=0.04;
L4.Jm=0.04;
L5.Jm=0.04;
L6.Jm=1;
L7.Jm=1;

modrobot=SerialLink([ML0 ML1 ML2 ML3 ML4 ML5 ML6 ML7],'name','7DOF ARM');
modrobot.display();     % 显示DH参数表

q0 = [-pi/2+dtheta1, DH(1, 1)+dtheta2, DH(2, 1), DH(3, 1), DH(4, 1), DH(5, 1) DH(6, 1), DH(7, 1)];

q_g = [0, 0, -0.5, 0, -1.57, 0, 0, 0];

q = q_g + q0;

pose_g = [-0.24497613206254126, -0.0859192663544961, -0.3930191392697027, 0.0003395808088595284, 0.00020229025710003754, 0.8600634070682375, 0.5101870045245188];

% q0 = [0 -pi/2 0 -pi/2 0 0];
% q0 = [0 0 0 0 0 0 0];

modrobot.plot(q);

M = double(modrobot.fkine(q));
disp(M)
quat = rotm2quat(M(1:3,1:3));
disp(quat)

% modmyikine=modrobot.ikine(M);

% plot(modrobot,modmyikine)  % 画出轨迹动画
% modrobot.display()

% RPY角默认是X-Y-Z顺序旋转
modrobot.teach(q0,'rpy/zyx');  
